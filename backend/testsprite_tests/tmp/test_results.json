[
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "49844a6a-a1ac-4b55-b352-2a3d5ec6e012",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC001-user registration with firebase",
    "description": "Test the user registration endpoint to ensure new users can sign up with valid username, email, password, and user_type, and that the Firebase authentication is properly integrated.",
    "code": "import requests\nimport uuid\n\nBASE_URL = \"http://localhost:8000\"\nSIGNUP_ENDPOINT = \"/api/auth/signup\"\n\ndef test_user_registration_with_firebase():\n    url = BASE_URL + SIGNUP_ENDPOINT\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    unique_str = str(uuid.uuid4())[:8]\n    payload = {\n        \"username\": f\"testuser_{unique_str}\",\n        \"email\": f\"testuser_{unique_str}@example.com\",\n        \"password\": \"StrongP@ssw0rd123\",\n        \"user_type\": \"freelancer\"\n    }\n\n    try:\n        response = requests.post(url, json=payload, headers=headers, timeout=30)\n        assert response.status_code in (200, 201), f\"Unexpected status code: {response.status_code}\"\n        data = response.json()\n        assert \"uid\" in data, \"Response missing expected user identifier 'uid'\"\n    except requests.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n    except ValueError:\n        assert False, \"Response is not valid JSON\"\n\ntest_user_registration_with_firebase()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 30, in <module>\n  File \"<string>\", line 24, in test_user_registration_with_firebase\nAssertionError: Response missing expected user identifier 'uid'\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.509Z",
    "modified": "2025-11-01T16:32:25.305Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "d8726640-e93e-4348-a1f2-240430094770",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC002-user login with email and password",
    "description": "Verify the login endpoint accepts valid email and password, authenticates the user via Firebase, and returns a valid JWT token with appropriate role-based access.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\n\ndef test_user_login_with_email_password():\n    login_url = f\"{BASE_URL}/api/auth/login\"\n    email = \"test@gmail.com\"\n    password = \"111111\"\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n    payload = {\n        \"email\": email,\n        \"password\": password\n    }\n    try:\n        response = requests.post(login_url, json=payload, headers=headers, timeout=TIMEOUT)\n    except requests.RequestException as e:\n        assert False, f\"Request to login endpoint failed: {e}\"\n\n    assert response.status_code == 200, f\"Login failed with status code {response.status_code} and body {response.text}\"\n    resp_json = response.json()\n    # Validate presence of JWT token\n    assert \"token\" in resp_json, \"Response JSON does not contain 'token'\"\n    token = resp_json.get(\"token\")\n    assert isinstance(token, str) and len(token) > 0, \"JWT token is empty or invalid\"\n\n    # Validate presence of user role in response if available\n    # Assuming API returns e.g. 'role' or 'user' object with role info\n    # This must be according to the API. We check common fields:\n    assert any(k in resp_json for k in [\"role\", \"user\", \"roles\"]), \"Response does not contain role information\"\n\n    # Optional: Check token format (JWT tokens have 3 parts separated by dots)\n    parts = token.split('.')\n    assert len(parts) == 3, \"JWT token format invalid\"\n\ntest_user_login_with_email_password()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 38, in <module>\n  File \"<string>\", line 22, in test_user_login_with_email_password\nAssertionError: Login failed with status code 401 and body {\"detail\":\"This account uses Firebase authentication. Please use 'Continue with Google' or sign in through Firebase.\"}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.514Z",
    "modified": "2025-11-01T16:32:21.345Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "c2d44f6d-4f1a-4876-8b96-fef42d7fcded",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC003-verify firebase token authentication",
    "description": "Test the Firebase token verification endpoint to ensure it correctly validates the Authorization header token and enforces role-based access control.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000\"\nVERIFY_ENDPOINT = \"/api/auth/firebase/verify\"\nLOGIN_ENDPOINT = \"/api/auth/login\"\nTIMEOUT = 30\n\ndef test_verify_firebase_token_authentication():\n    try:\n        # First, login to get a valid Firebase token via email/password\n        login_payload = {\n            \"email\": \"test@gmail.com\",\n            \"password\": \"111111\"\n        }\n        login_resp = requests.post(\n            BASE_URL + LOGIN_ENDPOINT,\n            json=login_payload,\n            timeout=TIMEOUT,\n            headers={\"Content-Type\": \"application/json\"}\n        )\n        assert login_resp.status_code == 200\n        login_data = login_resp.json()\n        token = login_data.get(\"access_token\") or login_data.get(\"token\")\n        assert token and isinstance(token, str), \"Token not found in login response\"\n\n        # Test valid token verification\n        headers = {\n            \"Authorization\": f\"Bearer {token}\"\n        }\n        verify_resp = requests.post(\n            BASE_URL + VERIFY_ENDPOINT,\n            headers=headers,\n            timeout=TIMEOUT\n        )\n        assert verify_resp.status_code == 200\n        verify_data = verify_resp.json()\n        # The response should indicate the token is valid and include role/access info\n        assert verify_data.get(\"valid\") is True or verify_data.get(\"success\") is True, \"Token verification failed\"\n        # Check role-based access field exists and is valid only if token is valid\n        assert \"role\" in verify_data and verify_data[\"role\"] in [\"client\", \"freelancer\"], \"Role missing or invalid\"\n\n        # Test with invalid token (random string)\n        headers_invalid = {\n            \"Authorization\": \"Bearer invalidtoken123\"\n        }\n        invalid_resp = requests.post(\n            BASE_URL + VERIFY_ENDPOINT,\n            headers=headers_invalid,\n            timeout=TIMEOUT\n        )\n        assert invalid_resp.status_code in [401, 403], \"Invalid token did not return proper error code\"\n        invalid_data = invalid_resp.json()\n        assert invalid_data.get(\"valid\") is False or invalid_data.get(\"error\") or invalid_data.get(\"message\"), \"Invalid token error message missing\"\n\n        # Test missing Authorization header\n        no_auth_resp = requests.post(\n            BASE_URL + VERIFY_ENDPOINT,\n            timeout=TIMEOUT\n        )\n        assert no_auth_resp.status_code in [401, 403], \"Missing auth header did not return proper error code\"\n        no_auth_data = no_auth_resp.json()\n        assert no_auth_data.get(\"error\") or no_auth_data.get(\"message\"), \"Missing auth error message missing\"\n    except requests.RequestException as e:\n        assert False, f\"Request failed with exception: {e}\"\n\ntest_verify_firebase_token_authentication()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 66, in <module>\n  File \"<string>\", line 21, in test_verify_firebase_token_authentication\nAssertionError\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.519Z",
    "modified": "2025-11-01T16:32:36.297Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "5528f6e2-905c-4c9f-b933-0e0df70db8bd",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC004-send password reset email",
    "description": "Validate the forgot-password endpoint sends a password reset email to the provided email address using the SMTP email service.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\n\nBASE_URL = \"http://localhost:8000\"\nTIMEOUT = 30\nAUTH_USERNAME = \"test@gmail.com\"\nAUTH_PASSWORD = \"111111\"\n\ndef test_send_password_reset_email():\n    url = f\"{BASE_URL}/api/auth/forgot-password\"\n    headers = {\n        \"Content-Type\": \"application/json\",\n        \"Accept\": \"application/json\"\n    }\n    payload = {\n        \"email\": AUTH_USERNAME\n    }\n    try:\n        # Use basic token auth as per instructions\n        response = requests.post(\n            url,\n            json=payload,\n            headers=headers,\n            auth=HTTPBasicAuth(AUTH_USERNAME, AUTH_PASSWORD),\n            timeout=TIMEOUT\n        )\n        # Validate success response\n        assert response.status_code == 200, f\"Expected 200 OK, got {response.status_code}\"\n        json_response = response.json()\n        # Assert response contains indication of email sent status\n        assert \"message\" in json_response or \"success\" in json_response, \"Response missing confirmation message\"\n        msg = json_response.get(\"message\") or json_response.get(\"success\")\n        assert isinstance(msg, str) and len(msg) > 0, \"Empty confirmation message\"\n    except requests.exceptions.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\ntest_send_password_reset_email()",
    "testStatus": "PASSED",
    "testError": "",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.524Z",
    "modified": "2025-11-01T16:32:04.368Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "7d827bf3-142e-4a9c-8868-7f3da3d4151a",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC005-verify otp for password reset",
    "description": "Test the OTP verification endpoint to ensure it correctly verifies the OTP for the given email and allows setting a new password.",
    "code": "import requests\n\nBASE_URL = \"http://localhost:8000/api/auth\"\nTIMEOUT = 30\n\ndef test_verify_otp_password_reset():\n    headers = {\n        \"Content-Type\": \"application/json\"\n    }\n\n    email = \"test@gmail.com\"\n    new_password = \"NewSecurePassword123!\"\n    invalid_otp = \"000000\"  # Assume invalid OTP\n\n    payload_invalid = {\n        \"email\": email,\n        \"otp\": invalid_otp,\n        \"new_password\": new_password\n    }\n\n    url_verify_otp = BASE_URL + \"/verify-otp\"\n    try:\n        resp_invalid = requests.post(url_verify_otp, json=payload_invalid, headers=headers, timeout=TIMEOUT)\n        assert resp_invalid.status_code in (400, 401)\n        json_resp_invalid = resp_invalid.json()\n        assert \"error\" in json_resp_invalid or \"message\" in json_resp_invalid\n\n        valid_otp = \"123456\"\n        payload_valid = {\n            \"email\": email,\n            \"otp\": valid_otp,\n            \"new_password\": new_password\n        }\n        resp_valid = requests.post(url_verify_otp, json=payload_valid, headers=headers, timeout=TIMEOUT)\n\n        if resp_valid.status_code == 200:\n            json_resp_valid = resp_valid.json()\n            assert \"message\" in json_resp_valid or \"success\" in json_resp_valid\n        else:\n            assert resp_valid.status_code in (400, 401, 422)\n            json_resp_valid = resp_valid.json()\n            assert \"error\" in json_resp_valid or \"message\" in json_resp_valid\n\n    except requests.exceptions.RequestException as e:\n        assert False, f\"Request failed: {e}\"\n\n\ntest_verify_otp_password_reset()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 48, in <module>\n  File \"<string>\", line 26, in test_verify_otp_password_reset\nAssertionError\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.528Z",
    "modified": "2025-11-01T16:32:32.401Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "cfef89c2-cd8a-4b12-8645-2c666bef4808",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC006-create new task with validation",
    "description": "Test the task creation endpoint to ensure clients can create tasks with all required fields, including title, description, category, budget, deadline, skills, expected_files_count, and validation_code.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\nimport datetime\n\nBASE_URL = \"http://localhost:8000/api\"\nTASKS_ENDPOINT = f\"{BASE_URL}/tasks\"\nAUTH_LOGIN_ENDPOINT = f\"{BASE_URL}/auth/login\"\nUSERNAME = \"test@gmail.com\"\nPASSWORD = \"111111\"\nTIMEOUT = 30\n\ndef test_create_new_task_with_validation():\n    # Authenticate and get token\n    auth_resp = requests.post(\n        AUTH_LOGIN_ENDPOINT,\n        json={\"email\": USERNAME, \"password\": PASSWORD},\n        timeout=TIMEOUT\n    )\n    assert auth_resp.status_code == 200, f\"Authentication failed: {auth_resp.text}\"\n    auth_data = auth_resp.json()\n    token = auth_data.get(\"access_token\") or auth_data.get(\"token\")\n    assert token, \"No token received in login response\"\n\n    headers = {\n        \"Authorization\": f\"Bearer {token}\",\n        \"Content-Type\": \"application/json\"\n    }\n\n    # Prepare task data\n    future_date = (datetime.datetime.utcnow() + datetime.timedelta(days=7)).isoformat() + \"Z\"\n    task_payload = {\n        \"title\": \"Test Task Title\",\n        \"description\": \"This is a test description for task creation with validation.\",\n        \"category\": \"Development\",\n        \"budget\": 1500.00,\n        \"deadline\": future_date,\n        \"skills\": [\"python\", \"blockchain\", \"zkp\"],\n        \"expected_files_count\": 3,\n        \"validation_code\": \"VAL123ABC\"\n    }\n\n    created_task_id = None\n\n    try:\n        # Create task\n        resp = requests.post(\n            TASKS_ENDPOINT,\n            headers=headers,\n            json=task_payload,\n            timeout=TIMEOUT\n        )\n        assert resp.status_code == 201, f\"Failed to create task: {resp.status_code} {resp.text}\"\n\n        task_data = resp.json()\n        created_task_id = task_data.get(\"id\") or task_data.get(\"task_id\")\n        assert created_task_id, \"Created task ID not returned\"\n\n        # Validate returned data matches sent data\n        assert task_data.get(\"title\") == task_payload[\"title\"], \"Title mismatch\"\n        assert task_data.get(\"description\") == task_payload[\"description\"], \"Description mismatch\"\n        assert task_data.get(\"category\") == task_payload[\"category\"], \"Category mismatch\"\n        assert float(task_data.get(\"budget\")) == task_payload[\"budget\"], \"Budget mismatch\"\n        assert task_data.get(\"deadline\").startswith(task_payload[\"deadline\"][:10]), \"Deadline mismatch\"\n        assert set(task_data.get(\"skills\", [])) == set(task_payload[\"skills\"]), \"Skills mismatch\"\n        assert int(task_data.get(\"expected_files_count\")) == task_payload[\"expected_files_count\"], \"Expected files count mismatch\"\n        assert task_data.get(\"validation_code\") == task_payload[\"validation_code\"], \"Validation code mismatch\"\n\n        # Test error case: missing required field (title)\n        invalid_payload = task_payload.copy()\n        invalid_payload.pop(\"title\")\n        error_resp = requests.post(\n            TASKS_ENDPOINT,\n            headers=headers,\n            json=invalid_payload,\n            timeout=TIMEOUT\n        )\n        assert error_resp.status_code == 422 or error_resp.status_code == 400, \"Expected validation error for missing title\"\n\n    finally:\n        # Cleanup: delete the created task if exists\n        if created_task_id:\n            del_resp = requests.delete(\n                f\"{TASKS_ENDPOINT}/{created_task_id}\",\n                headers=headers,\n                timeout=TIMEOUT\n            )\n            # It's not critical to assert delete here, but log if failed\n            if del_resp.status_code not in (200, 204):\n                print(f\"Warning: Failed to delete task {created_task_id}: {del_resp.status_code} {del_resp.text}\")\n\ntest_create_new_task_with_validation()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 91, in <module>\n  File \"<string>\", line 19, in test_create_new_task_with_validation\nAssertionError: Authentication failed: {\"detail\":\"This account uses Firebase authentication. Please use 'Continue with Google' or sign in through Firebase.\"}\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.533Z",
    "modified": "2025-11-01T16:32:12.228Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "d6e784df-0361-4abd-b148-236a8e7e3e20",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC007-upload files with submission",
    "description": "Verify the file upload endpoint accepts multipart/form-data with task_id, description, and multiple files, validates file size and type, and stores files securely.",
    "code": "import requests\nfrom requests.auth import HTTPBasicAuth\nimport io\n\nBASE_URL = \"http://localhost:8000\"\nAUTH_ENDPOINT = \"/api/auth/login\"\nTASKS_ENDPOINT = \"/api/tasks\"\nSUBMISSIONS_ENDPOINT = \"/api/submissions\"\nUSERNAME = \"test@gmail.com\"\nPASSWORD = \"111111\"\nTIMEOUT = 30\n\n\ndef get_auth_token():\n    url = f\"{BASE_URL}/api/auth/login\"\n    data = {\"email\": USERNAME, \"password\": PASSWORD}\n    response = requests.post(url, json=data, timeout=TIMEOUT)\n    response.raise_for_status()\n    json_resp = response.json()\n    token = json_resp.get(\"access_token\") or json_resp.get(\"token\")\n    if not token:\n        raise Exception(\"Authentication failed: no token returned\")\n    return token\n\n\ndef create_task(auth_token):\n    url = f\"{BASE_URL}{TASKS_ENDPOINT}\"\n    task_data = {\n        \"title\": \"Test Task for File Submission\",\n        \"description\": \"Task created for testing file upload submissions.\",\n        \"category\": \"Testing\",\n        \"budget\": 1000,\n        \"deadline\": \"2030-01-01T00:00:00Z\",\n        \"skills\": [\"python\", \"api\", \"testing\"],\n        \"expected_files_count\": 2,\n        \"validation_code\": \"VALID123\"\n    }\n    headers = {\"Authorization\": f\"Bearer {auth_token}\"}\n    response = requests.post(url, json=task_data, headers=headers, timeout=TIMEOUT)\n    response.raise_for_status()\n    return response.json()[\"id\"] if \"id\" in response.json() else response.json().get(\"task_id\")\n\n\ndef delete_task(task_id, auth_token):\n    url = f\"{BASE_URL}{TASKS_ENDPOINT}/{task_id}\"\n    headers = {\"Authorization\": f\"Bearer {auth_token}\"}\n    response = requests.delete(url, headers=headers, timeout=TIMEOUT)\n    # May not raise if delete not implemented, ignore errors here\n    return response.status_code\n\n\ndef test_TC007_upload_files_with_submission():\n    auth_token = get_auth_token()\n    headers = {\"Authorization\": f\"Bearer {auth_token}\"}\n\n    task_id = None\n    try:\n        # Create a task to attach submission files to\n        task_id = create_task(auth_token)\n        assert task_id, \"Failed to create a task to upload submission files\"\n\n        url = f\"{BASE_URL}/api/submissions\"\n        # Prepare multipart form data\n        # Files - create two small dummy files, one allowed type (txt), one allowed type (png)\n        file1_content = b\"Hello world: this is test file 1.\"\n        file2_content = b\"\\x89PNG\\r\\n\\x1a\\n\\x00\\x00\\x00\\rIHDR\\x00\"\n        files = [\n            (\"files\", (\"test1.txt\", io.BytesIO(file1_content), \"text/plain\")),\n            (\"files\", (\"image1.png\", io.BytesIO(file2_content), \"image/png\")),\n        ]\n        data = {\n            \"task_id\": str(task_id),\n            \"description\": \"Submission with multiple files for TC007 test\"\n        }\n        response = requests.post(\n            url,\n            headers=headers,\n            files=files,\n            data=data,\n            timeout=TIMEOUT,\n        )\n\n        # Validate response status and schema\n        assert response.status_code == 201 or response.status_code == 200, f\"Unexpected status code: {response.status_code}\"\n\n        resp_json = response.json()\n        # At minimum, expect submission id or similar confirmation\n        assert \"submission_id\" in resp_json or \"id\" in resp_json, \"Response missing submission identifier\"\n\n        # Validate files are accepted and metadata returned\n        submitted_files = resp_json.get(\"files\") or []\n        assert len(submitted_files) == 2, f\"Expected 2 files in response, got {len(submitted_files)}\"\n\n        # Validate file size constraints (no file > 50MB, we used tiny files)\n        for f in submitted_files:\n            assert \"size\" in f and f[\"size\"] <= 50 * 1024 * 1024, \"File size exceeds limit or missing\"\n\n        # Validate file types allowed - simple check content-type presence\n        for f in submitted_files:\n            assert \"content_type\" in f, \"File content_type missing in response\"\n\n        # Optionally, check that files stored securely (e.g. presence of secure URL or token)\n        for f in submitted_files:\n            assert \"secure_url\" in f or \"file_path\" in f or \"download_token\" in f, \"File security info missing\"\n\n    finally:\n        # Cleanup: delete task to remove submissions linked\n        if task_id:\n            try:\n                delete_task(task_id, auth_token)\n            except Exception:\n                pass\n\n\ntest_TC007_upload_files_with_submission()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 115, in <module>\n  File \"<string>\", line 53, in test_TC007_upload_files_with_submission\n  File \"<string>\", line 18, in get_auth_token\n  File \"/var/task/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: http://localhost:8000/api/auth/login\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.539Z",
    "modified": "2025-11-01T16:32:10.804Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "d6636d9d-0423-4756-ac09-84d7625a7ac4",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC008-generate zero knowledge proof for file validation",
    "description": "Test the ZKP generation endpoint to ensure it correctly generates zero-knowledge proofs for submitted files using Pedersen Commitments and Schnorr proofs without accessing file contents.",
    "code": "import requests\nimport base64\nimport json\nimport traceback\n\nBASE_URL = \"http://localhost:8000/api\"\nAUTH_USERNAME = \"test@gmail.com\"\nAUTH_PASSWORD = \"111111\"\nTIMEOUT = 30\n\ndef basic_auth_header(username: str, password: str) -> dict:\n    token = base64.b64encode(f\"{username}:{password}\".encode()).decode()\n    return {\"Authorization\": f\"Basic {token}\"}\n\ndef create_task(headers):\n    payload = {\n        \"title\": \"Test Task for ZKP Generation\",\n        \"description\": \"Task description for zero knowledge proof generation test.\",\n        \"category\": \"Testing\",\n        \"budget\": 1000,\n        \"deadline\": \"2030-12-31T23:59:59Z\",\n        \"skills\": [\"crypto\", \"python\", \"zkp\"],\n        \"expected_files_count\": 1,\n        \"validation_code\": \"VALID123\"  # Required field added\n    }\n    resp = requests.post(f\"{BASE_URL}/tasks\", headers=headers, json=payload, timeout=TIMEOUT)\n    resp.raise_for_status()\n    task_data = resp.json()\n    assert \"id\" in task_data, \"Task creation response missing 'id'\"\n    return task_data[\"id\"]\n\ndef upload_submission(headers, task_id):\n    files = {\n        \"files\": (\"testfile.txt\", b\"Dummy file content for ZKP test\", \"text/plain\")\n    }\n    data = {\n        \"task_id\": str(task_id),\n        \"description\": \"Submission for ZKP generation test\"\n    }\n    resp = requests.post(f\"{BASE_URL}/submissions\", headers=headers, files=files, data=data, timeout=TIMEOUT)\n    resp.raise_for_status()\n    submission_data = resp.json()\n    assert \"id\" in submission_data, \"Submission creation response missing 'id'\"\n    return submission_data[\"id\"]\n\ndef generate_zkp(headers, submission_id):\n    resp = requests.post(f\"{BASE_URL}/submissions/{submission_id}/generate-zkp\", headers=headers, timeout=TIMEOUT)\n    if resp.status_code == 404:\n        raise Exception(\"Submission not found for ZKP generation\")\n    resp.raise_for_status()\n    zkp_result = resp.json()\n    # Validate expected fields in ZKP result indicating Pedersen Commitments and Schnorr proofs data\n    assert isinstance(zkp_result, dict), \"ZKP generation result is not a dict\"\n    assert \"pedersen_commitment\" in zkp_result, \"Missing pedersen_commitment in ZKP result\"\n    assert \"schnorr_proof\" in zkp_result, \"Missing schnorr_proof in ZKP result\"\n    # Example simple fields checks\n    assert isinstance(zkp_result[\"pedersen_commitment\"], str), \"pedersen_commitment is not a string\"\n    assert isinstance(zkp_result[\"schnorr_proof\"], dict), \"schnorr_proof is not a dict\"\n    # schnorr_proof content validation (basic)\n    schnorr = zkp_result[\"schnorr_proof\"]\n    assert \"challenge\" in schnorr and isinstance(schnorr[\"challenge\"], str), \"Invalid schnorr_proof challenge\"\n    assert \"response\" in schnorr and isinstance(schnorr[\"response\"], str), \"Invalid schnorr_proof response\"\n\ndef delete_task(headers, task_id):\n    # Assuming a delete endpoint exists for cleanup; if not, ignore or implement differently\n    try:\n        resp = requests.delete(f\"{BASE_URL}/tasks/{task_id}\", headers=headers, timeout=TIMEOUT)\n        if resp.status_code not in (200, 204, 404):\n            resp.raise_for_status()\n    except Exception:\n        pass  # Best effort cleanup\n\ndef test_TC008_generate_zero_knowledge_proof_for_file_validation():\n    headers = basic_auth_header(AUTH_USERNAME, AUTH_PASSWORD)\n    task_id = None\n    submission_id = None\n    try:\n        # Create a new task\n        task_id = create_task(headers)\n\n        # Upload a submission file for the created task\n        submission_id = upload_submission(headers, task_id)\n\n        # Generate zero-knowledge proof for the submission\n        generate_zkp(headers, submission_id)\n    except Exception:\n        traceback.print_exc()\n        assert False, \"Test TC008 failed due to exception.\"\n    finally:\n        # Cleanup: delete created task to avoid polluting test data\n        if task_id:\n            delete_task(headers, task_id)\n\ntest_TC008_generate_zero_knowledge_proof_for_file_validation()",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"<string>\", line 79, in test_TC008_generate_zero_knowledge_proof_for_file_validation\n  File \"<string>\", line 27, in create_task\n  File \"/var/task/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 422 Client Error: Unprocessable Entity for url: http://localhost:8000/api/tasks\n\nDuring handling of the above exception, another exception occurred:\n\nTraceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 94, in <module>\n  File \"<string>\", line 88, in test_TC008_generate_zero_knowledge_proof_for_file_validation\nAssertionError: Test TC008 failed due to exception.\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.543Z",
    "modified": "2025-11-01T16:32:49.291Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "1f11921b-d937-42d5-b21d-f6fff4725701",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC009-approve individual file in submission",
    "description": "Verify the partial approval endpoint allows clients to approve individual files within a submission, records approval status, and updates proportional payment amounts.",
    "code": "import requests\nimport time\n\nBASE_URL = \"http://localhost:8000\"\nAUTH_CREDENTIALS = (\"test@gmail.com\", \"111111\")\nTIMEOUT = 30\n\ndef authenticate():\n    login_url = f\"{BASE_URL}/api/auth/login\"\n    payload = {\n        \"email\": AUTH_CREDENTIALS[0],\n        \"password\": AUTH_CREDENTIALS[1]\n    }\n    response = requests.post(login_url, json=payload, timeout=TIMEOUT)\n    response.raise_for_status()\n    token = response.json().get(\"access_token\")\n    assert token, \"No access token received after login\"\n    return token\n\n\ndef create_task(token):\n    url = f\"{BASE_URL}/api/tasks\"\n    headers = {\"Authorization\": f\"Bearer {token}\"}\n    payload = {\n        \"title\": \"Test Task for Partial Approval\",\n        \"description\": \"Task created for testing file partial approval system.\",\n        \"category\": \"Testing\",\n        \"budget\": 1000,\n        \"deadline\": (int(time.time()) + 3600 * 24 * 7),  # 7 days from now as epoch timestamp\n        \"skills\": [\"python\", \"blockchain\", \"zkp\"],\n        \"expected_files_count\": 2,\n        \"validation_code\": \"VALID1234\"\n    }\n    resp = requests.post(url, json=payload, headers=headers, timeout=TIMEOUT)\n    resp.raise_for_status()\n    task = resp.json()\n    assert \"id\" in task, \"Created task response missing task ID\"\n    return task[\"id\"]\n\n\ndef upload_submission(token, task_id):\n    url = f\"{BASE_URL}/api/submissions\"\n    headers = {\"Authorization\": f\"Bearer {token}\"}\n\n    # Multipart form data fields\n    data = {\n        \"task_id\": str(task_id),\n        \"description\": \"Submission for partial approval testing\"\n    }\n    # Provide files as a list of tuples\n    files_for_requests = [\n        (\"files\", (\"file1.txt\", b\"File content 1\", \"text/plain\")),\n        (\"files\", (\"file2.txt\", b\"File content 2\", \"text/plain\")),\n    ]\n\n    resp = requests.post(url, headers=headers, data=data, files=files_for_requests, timeout=TIMEOUT)\n    resp.raise_for_status()\n    submission = resp.json()\n    assert \"id\" in submission, \"Submission response missing submission ID\"\n    assert \"files\" in submission and len(submission[\"files\"]) >= 2, \"Submission files missing or insufficient\"\n    return submission\n\n\ndef approve_individual_file(token, submission_id, file_id):\n    url = f\"{BASE_URL}/api/submissions/{submission_id}/files/{file_id}/approve\"\n    headers = {\"Authorization\": f\"Bearer {token}\"}\n    resp = requests.put(url, headers=headers, timeout=TIMEOUT)\n    resp.raise_for_status()\n    approval_resp = resp.json()\n    assert approval_resp.get(\"approved\") is True or approval_resp.get(\"status\") == \"approved\", \"File not approved\"\n    return approval_resp\n\n\ndef get_submission(token, submission_id):\n    url = f\"{BASE_URL}/api/submissions/{submission_id}\"\n    headers = {\"Authorization\": f\"Bearer {token}\"}\n    resp = requests.get(url, headers=headers, timeout=TIMEOUT)\n    resp.raise_for_status()\n    submission = resp.json()\n    return submission\n\n\ndef TC009_approve_individual_file_in_submission():\n    token = None\n    task_id = None\n    submission = None\n    try:\n        token = authenticate()\n\n        # Create a new task to submit files for\n        task_id = create_task(token)\n\n        # Upload submission with multiple files\n        submission = upload_submission(token, task_id)\n        submission_id = submission[\"id\"]\n        files = submission[\"files\"]\n        assert isinstance(files, list) and len(files) > 0, \"Submission should have files\"\n\n        # Pick first file to approve\n        file_to_approve = files[0]\n        file_id = file_to_approve.get(\"id\")\n        assert file_id, \"File in submission missing file ID\"\n\n        # Approve individual file\n        approval_response = approve_individual_file(token, submission_id, file_id)\n\n        # Validate approval recorded and proportional payment updated (check response fields)\n        assert \"payment_amount\" in approval_response or \"proportional_payment\" in approval_response, \"Payment info missing after approval\"\n\n        # Check submission's file approval status updated\n        updated_submission = get_submission(token, submission_id)\n        updated_files = updated_submission.get(\"files\", [])\n        file_status = None\n        for f in updated_files:\n            if f.get(\"id\") == file_id:\n                file_status = f.get(\"approval_status\")\n                break\n        assert file_status == \"approved\", \"File approval status not updated in submission\"\n\n        # Also check partial payment amount key exists in submission data\n        assert \"proportional_payment_amount\" in updated_submission or \"payment_status\" in updated_submission or \"payment\" in updated_submission, \"Proportional payment info missing in submission after approval\"\n\n    finally:\n        # Cleanup: delete the submission and task if created\n        headers = {\"Authorization\": f\"Bearer {token}\"} if token else {}\n        if submission is not None:\n            try:\n                requests.delete(f\"{BASE_URL}/api/submissions/{submission['id']}\", headers=headers, timeout=TIMEOUT)\n            except Exception:\n                pass\n        if task_id is not None:\n            try:\n                requests.delete(f\"{BASE_URL}/api/tasks/{task_id}\", headers=headers, timeout=TIMEOUT)\n            except Exception:\n                pass\n\n\nTC009_approve_individual_file_in_submission()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 138, in <module>\n  File \"<string>\", line 88, in TC009_approve_individual_file_in_submission\n  File \"<string>\", line 15, in authenticate\n  File \"/var/task/requests/models.py\", line 1024, in raise_for_status\n    raise HTTPError(http_error_msg, response=self)\nrequests.exceptions.HTTPError: 401 Client Error: Unauthorized for url: http://localhost:8000/api/auth/login\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.548Z",
    "modified": "2025-11-01T16:32:40.861Z"
  },
  {
    "projectId": "26f2c60f-9287-4a93-9e32-b43841b1b51d",
    "testId": "83617d6d-a740-45bc-9239-bfa65bdc1c1b",
    "userId": "34184418-f0c1-7004-77fd-a905b0d1d49e",
    "title": "TC010-claim payment for approved work",
    "description": "Test the payment claim endpoint to ensure users can claim payments for approved submissions by providing submission_id, wallet_address, and transaction_hash, and that Ethereum blockchain transactions are processed correctly.",
    "code": "import requests\nimport time\n\nBASE_URL = \"http://localhost:8000\"\n\nTOKEN = \"<PLACEHOLDER_FOR_VALID_FIREBASE_JWT_TOKEN>\"  # Replace with a valid Firebase JWT token for testing\nTIMEOUT = 30\n\ndef test_claim_payment_for_approved_work():\n    headers = {}\n    # Use a valid Firebase JWT access token obtained externally\n    token = TOKEN\n    assert token and token != \"<PLACEHOLDER_FOR_VALID_FIREBASE_JWT_TOKEN>\", \"Please set a valid Firebase JWT token in TOKEN variable\"\n    headers[\"Authorization\"] = f\"Bearer {token}\"\n\n    # Helper function: Create new task (as client) - required for submission\n    task_payload = {\n        \"title\": \"Test Task For Payment Claim\",\n        \"description\": \"Task created for testing payment claim after partial approval\",\n        \"category\": \"testing\",\n        \"budget\": 100,\n        \"deadline\": \"2030-12-31T23:59:59Z\",\n        \"skills\": [\"python\", \"blockchain\"],\n        \"expected_files_count\": 1,\n        \"validation_code\": \"VALID123\"\n    }\n    task_resp = requests.post(f\"{BASE_URL}/api/tasks\", json=task_payload, headers=headers, timeout=TIMEOUT)\n    assert task_resp.status_code == 201, f\"Task creation failed: {task_resp.text}\"\n    task = task_resp.json()\n    task_id = task.get(\"id\") or task.get(\"task_id\")\n    assert task_id, \"No task_id returned from task creation\"\n\n    submission_id = None\n    try:\n        # Step 2: Upload a file submission as freelancer for the task\n        files = {\n            \"files\": (\"testfile.txt\", b\"Test file content for payment claim\", \"text/plain\")\n        }\n        submission_payload = {\n            \"task_id\": str(task_id),\n            \"description\": \"Submission for testing payment claim\"\n        }\n        submit_resp = requests.post(f\"{BASE_URL}/api/submissions\",\n                                    data=submission_payload,\n                                    files=files,\n                                    headers=headers,\n                                    timeout=TIMEOUT)\n        assert submit_resp.status_code == 201, f\"Submission upload failed: {submit_resp.text}\"\n        submission = submit_resp.json()\n        submission_id = submission.get(\"id\") or submission.get(\"submission_id\")\n        assert submission_id, \"No submission_id returned from submission upload\"\n\n        # Step 3: Approve the submission entirely to simulate approved work\n        approve_resp = requests.put(f\"{BASE_URL}/api/submissions/{submission_id}/approve\",\n                                   headers=headers,\n                                   timeout=TIMEOUT)\n        assert approve_resp.status_code == 200, f\"Approving submission failed: {approve_resp.text}\"\n\n        # Step 4: Claim payment for the approved submission providing wallet address and dummy tx hash\n        claim_payload = {\n            \"submission_id\": submission_id,\n            \"wallet_address\": \"0x1234567890abcdef1234567890abcdef12345678\",\n            \"transaction_hash\": \"0xabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdefabcdef\"\n        }\n        claim_resp = requests.post(f\"{BASE_URL}/api/payments/claim\",\n                                  json=claim_payload,\n                                  headers=headers,\n                                  timeout=TIMEOUT)\n        assert claim_resp.status_code == 200, f\"Payment claim failed: {claim_resp.text}\"\n        claim_data = claim_resp.json()\n        assert \"status\" in claim_data, \"No status key in payment claim response\"\n        assert claim_data[\"status\"] in [\"pending\", \"processed\", \"success\"], \\\n            f\"Unexpected payment claim status: {claim_data['status']}\"\n\n        # Step 5: Optionally confirm payment claim status by retrieving it\n        status_resp = requests.get(f\"{BASE_URL}/api/submissions/{submission_id}/payment-status\",\n                                   headers=headers,\n                                   timeout=TIMEOUT)\n        assert status_resp.status_code == 200, f\"Payment status check failed: {status_resp.text}\"\n        status_data = status_resp.json()\n        assert \"payment_claimed\" in status_data, \"Payment status response missing 'payment_claimed'\"\n        assert isinstance(status_data[\"payment_claimed\"], bool), \"'payment_claimed' should be boolean\"\n\n    finally:\n        # Cleanup: Delete submission if created\n        if submission_id:\n            try:\n                requests.delete(f\"{BASE_URL}/api/submissions/{submission_id}\",\n                                headers=headers,\n                                timeout=TIMEOUT)\n            except Exception:\n                pass\n        # Cleanup: Delete task if created\n        if task_id:\n            try:\n                requests.delete(f\"{BASE_URL}/api/tasks/{task_id}\",\n                                headers=headers,\n                                timeout=TIMEOUT)\n            except Exception:\n                pass\n\ntest_claim_payment_for_approved_work()\n",
    "testStatus": "FAILED",
    "testError": "Traceback (most recent call last):\n  File \"/var/task/handler.py\", line 258, in run_with_retry\n    exec(code, exec_env)\n  File \"<string>\", line 102, in <module>\n  File \"<string>\", line 13, in test_claim_payment_for_approved_work\nAssertionError: Please set a valid Firebase JWT token in TOKEN variable\n",
    "testType": "BACKEND",
    "createFrom": "mcp",
    "created": "2025-11-01T16:31:11.553Z",
    "modified": "2025-11-01T16:32:45.766Z"
  }
]
